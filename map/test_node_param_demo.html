<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Node URL Parameter Feature</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #1a73e8;
            border-bottom: 3px solid #1a73e8;
            padding-bottom: 10px;
        }
        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-link {
            display: block;
            padding: 12px 20px;
            margin: 10px 0;
            background: #1a73e8;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: background 0.2s;
        }
        .test-link:hover {
            background: #1557b0;
        }
        .code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.9em;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.pass {
            background: #34a853;
            color: white;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }
        .feature-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #34a853;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üó∫Ô∏è Map Node URL Parameter - Test Page</h1>
    
    <div class="section">
        <h2>Feature Status <span class="status pass">‚úì IMPLEMENTED</span></h2>
        <p>The map now supports automatic node search and zoom via URL parameters.</p>
    </div>
    
    <div class="section">
        <h2>Features Implemented</h2>
        <ul class="feature-list">
            <li>Parse <span class="code">?node=</span> parameter from URL</li>
            <li>Auto-populate search input with node name/ID</li>
            <li>Automatically trigger search after map loads</li>
            <li>Zoom to node if found</li>
            <li>Show results list if multiple matches</li>
            <li>Display error if node not found or filtered</li>
            <li>Compatible with <span class="code">?view=</span> parameter</li>
        </ul>
    </div>
    
    <div class="section">
        <h2>Test Links</h2>
        <p>Click these links to test the feature (these will work when accessing a real Meshtastic map):</p>
        
        <a href="map.html?node=tigro" class="test-link" target="_blank">
            Test 1: Search for "tigro"
        </a>
        <p style="margin-left: 20px; color: #666;">
            URL: <span class="code">map.html?node=tigro</span>
        </p>
        
        <a href="map.html?node=a2e175ac" class="test-link" target="_blank">
            Test 2: Search by node ID
        </a>
        <p style="margin-left: 20px; color: #666;">
            URL: <span class="code">map.html?node=a2e175ac</span>
        </p>
        
        <a href="map.html?view=both&node=tigro" class="test-link" target="_blank">
            Test 3: Combined view + node parameters
        </a>
        <p style="margin-left: 20px; color: #666;">
            URL: <span class="code">map.html?view=both&node=tigro</span>
        </p>
        
        <a href="map.html?node=G2%20PV" class="test-link" target="_blank">
            Test 4: Search with URL-encoded spaces
        </a>
        <p style="margin-left: 20px; color: #666;">
            URL: <span class="code">map.html?node=G2%20PV</span>
        </p>
    </div>
    
    <div class="section">
        <h2>How It Works</h2>
        <ol>
            <li><strong>URL Parsing:</strong> On page load, <span class="code">initFromURLParams()</span> extracts the <span class="code">node</span> parameter</li>
            <li><strong>Input Population:</strong> The search input field is pre-filled with the node value</li>
            <li><strong>Storage:</strong> The parameter value is stored in <span class="code">window.nodeParamToSearch</span></li>
            <li><strong>Data Loading:</strong> Map initializes and loads node data from server</li>
            <li><strong>Auto-Search:</strong> After 500ms delay, <span class="code">searchNode()</span> is called automatically</li>
            <li><strong>Node Search:</strong> Existing search logic finds matching nodes (by name or ID)</li>
            <li><strong>Zoom:</strong> If single match found, map zooms to node and highlights it</li>
            <li><strong>Cleanup:</strong> Temporary variable is deleted to prevent re-triggering</li>
        </ol>
    </div>
    
    <div class="section">
        <h2>Use Cases</h2>
        <ul>
            <li>üìö <strong>Documentation:</strong> Link directly to specific nodes in guides</li>
            <li>üîó <strong>Sharing:</strong> Send direct links to team members showing specific nodes</li>
            <li>‚≠ê <strong>Bookmarks:</strong> Save favorite nodes for quick access</li>
            <li>üìä <strong>Dashboards:</strong> Integrate with monitoring tools and dashboards</li>
            <li>ü§ñ <strong>Automation:</strong> Generate map links programmatically</li>
        </ul>
    </div>
    
    <div class="section">
        <h2>Code Changes</h2>
        <p><strong>Files Modified:</strong></p>
        <ul>
            <li><span class="code">map/map.html</span> - Added node parameter handling</li>
            <li><span class="code">map/MAP_SEARCH_FEATURE.md</span> - Updated documentation</li>
        </ul>
        
        <p><strong>Key Functions:</strong></p>
        <ul>
            <li><span class="code">initFromURLParams()</span> - Parses URL and sets up node search</li>
            <li><span class="code">initMap()</span> - Triggers search after data loads</li>
            <li><span class="code">searchNode()</span> - Existing function, reused for auto-search</li>
        </ul>
    </div>
    
    <div class="section">
        <h2>Validation</h2>
        <p>Run the test script to validate the implementation:</p>
        <pre style="background: #f0f0f0; padding: 15px; border-radius: 6px; overflow-x: auto;"><code>cd map
./test_node_param.sh</code></pre>
        <p>All 7 tests should pass ‚úì</p>
    </div>
    
    <div class="section" style="background: #e8f5e9; border-left: 4px solid #4caf50;">
        <h2 style="color: #2e7d32;">‚úì Implementation Complete</h2>
        <p>The feature is ready for use. Users can now navigate directly to specific nodes using URL parameters.</p>
        <p><strong>Example:</strong> <span class="code">https://tigro.fr/map.html?node=tigro</span></p>
    </div>
</body>
</html>
